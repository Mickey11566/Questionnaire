@if (surveyData && userAnswers) {
<main>
  <div class="formHeader">
    <div class="formDate">
      <h3>可填寫時間： {{surveyData.startDate}} 至 {{surveyData.endDate}}</h3>
    </div>
  </div>

  <div class="formInfo">
    <div class="formTitle">
      <h1>{{surveyData.name}}</h1>
    </div>
    <div class="formDescription">
      <h3>{{surveyData.description}}</h3>
    </div>
  </div>

  <div class="formContent">

    @if (surveyData.questions && surveyData.questions.length > 0) {
    <div class="question-list">

      @for (question of surveyData.questions; track question.id; let i = $index) {
      <div class="question-item" style="
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1vh;">

        <h2>
          Q{{i + 1}}. {{question.text}}
          @if (question.required) {
          <span style="color: red;">*</span>
          }
        </h2>

        @switch (question.type) {

        @case ('single') {
        @for (option of question.options; track option) {
        <div class="option">
          <input type="radio" [id]="'q' + question.id + 'opt' + option" [name]="question.id.toString()"
            [(ngModel)]="userAnswers[question.id.toString()]" [value]="option" [required]="question.required">
          <label [for]="'q' + question.id + 'opt' + option">{{option}}</label>
        </div>
        }
        }

        @case ('multiple') {
        @for (option of question.options; track option) {
        <div class="option">
          <input type="checkbox" [id]="'q' + question.id + 'opt' + option" [name]="question.id.toString()"
            [value]="option" [checked]="userAnswers[question.id.toString()]?.includes(option)"
            (change)="onCheckboxChange(question.id.toString(), option, $event)" [required]="question.required">

          <label [for]="'q' + question.id + 'opt' + option">{{option}}</label>
        </div>
        }
        }

        @case ('short-answer') {
        <textarea [(ngModel)]="userAnswers[question.id.toString()]" [name]="question.id.toString()"
          [required]="question.required" style="resize: none; border-radius: 4px; font-size: 1rem; font-weight: 700;"
          rows="4" cols="30" maxlength="100" placeholder="請在此輸入您的回答..."></textarea>
        }

        @default {
        <p>無法識別的問題類型。</p>
        }
        }

      </div>
      }
    </div>
    } @else {
    <p>此問卷目前沒有任何問題。</p>
    }


    <div class="formButton">
      <button class="cancleBtn" (click)="backList()">返回</button>

      <button class="reviewBtn" (click)="previewForm()">預覽</button>
    </div>
  </div>
</main>
} @else {
<p>正在載入問卷資料...</p>
}