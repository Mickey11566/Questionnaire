<main>

  <div class="searchHeader">

    <div class="searchContent">
      <mat-form-field appearance="outline" class="search-form-field">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput type="text" placeholder="搜尋問卷名稱" (keyup)="searchForm()" [(ngModel)]="searchData">
      </mat-form-field>
    </div>

    <div class="searchDate">
      <mat-form-field>
        <mat-label>選擇開始日期</mat-label>
        <input [(ngModel)]="startDate" matInput [matDatepicker]="pickerStart" (dateChange)="searchForm()">
        <mat-datepicker-toggle matIconSuffix [for]="pickerStart"></mat-datepicker-toggle>
        <mat-datepicker #pickerStart></mat-datepicker>
      </mat-form-field>

      <mat-form-field>
        <mat-label>選擇結束日期</mat-label>
        <input [(ngModel)]="endDate" matInput [matDatepicker]="pickerEnd" (dateChange)="searchForm()">
        <mat-datepicker-toggle matIconSuffix [for]="pickerEnd"></mat-datepicker-toggle>
        <mat-datepicker #pickerEnd></mat-datepicker>
      </mat-form-field>
    </div>

  </div>
  <div>
    <div style="color: #D67C2F; display: flex;">
      <mat-icon class="deleteIcon" style="border: 2px solid; border-radius: 50%; padding: 0.5vh; margin-left: 1vw;"
        (click)="deleteForm()" aria-hidden="false" aria-label="delete icon" fontIcon="delete_forever"></mat-icon>
    </div>
    <table class="data-table" id="myTable">
      <thead>
        <tr>
          <th>選擇</th>
          <!-- <th>編號</th> -->
          <th>名稱</th>
          <th class="status-col">狀態</th>
          <th>開始日期</th>
          <th>結束日期</th>
          <th>結果</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        @for (item of pagedData; track item.id; let i = $index) {
        <tr [class.highlight-row]="i % 2 === 0">
          <td>
            <input type="checkbox" [checked]="selectedItemIds.has(item.id)"
              (change)="onCheckboxChange(item.id, $event)">
          </td>
          <!-- <td>{{ item.id }}</td> -->
          <td>{{ item.name }}</td>

          <td class="status-cell" [ngClass]="{
            'status-inprogress': item.status === '進行中',
            'status-pending': item.status === '尚未開始',
            'status-finished': item.status === '已結束'}">
            {{ item.status }}
          </td>

          <td>{{ item.startDate }}</td>
          <td>{{ item.endDate }}</td>

          <td class="action-cell">
            @if (item.status === "已結束") {
            <button (click)="toResult()" class="result-button">查看</button>
            }
          </td>

          <td class="action-cell">
            @if (item.status === "進行中" || item.status ==="已結束") {
            <button class="fillout-button" (click)="checkout(item.id)">
              查看問卷
            </button>
            } @else {
            <button class="fillout-button" (click)="revise(item.id)">
              修改問卷
            </button>
            }
          </td>
        </tr>
        } @empty {
        <tr>
          <td colspan="8" style="text-align: center;">無資料可供顯示。</td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="pagination-controls" style="margin-top: 20px; text-align: center;">

    <span style="margin-right: 15px;">
      第 {{ currentPage }} 頁 / 共 {{ totalPages }} 頁
    </span>

    <button (click)="previousPage()" [disabled]="currentPage === 1" style="padding: 5px 10px; margin-right: 5px;">
      上一頁
    </button>

    @for (page of getPagesArray(); track page) {
    <button (click)="goToPage(page)" [class.active-page]="currentPage === page"
      style="padding: 5px 10px; margin: 0 2px; border: 1px solid #ccc; cursor: pointer;"
      [style.background-color]="currentPage === page ? '#FFA640' : 'white'"
      [style.color]="currentPage === page ? 'white' : 'black'">
      {{ page }}
    </button>
    }

    <button (click)="nextPage()" [disabled]="currentPage === totalPages" style="padding: 5px 10px; margin-left: 5px;">
      下一頁
    </button>

  </div>
</main>

<nav class="navBar">

  <!-- <button>
  </button>
  <button>
    <mat-icon aria-hidden="false" aria-label="logout icon" fontIcon="logout"></mat-icon>
  </button> -->
  <ul>
    <li (click)="addForm()" style="--i:#FF9966;--j:#FF5E62">
      <span class="icon"> <mat-icon aria-hidden="false" aria-label="plus icon" fontIcon="add"></mat-icon></span>
      <span class="title">新增問卷</span>
    </li>
    <li (click)="logout()" style="--i:#FF9966;--j:#FF5E62">
      <span class="icon"> <mat-icon aria-hidden="false" aria-label="logout icon" fontIcon="logout"></mat-icon></span>
      <span class="title">登出</span>
    </li>
  </ul>
</nav>